From: Clint Adams <clint@debian.org>
Date: Sun, 1 May 2016 14:46:49 +0200
Subject: fix yacc

Forwarded: no
---
 lib/framework/resource_parser.ypp |  2 +-
 lib/framework/strres_lexer.lpp    |  2 +-
 lib/framework/strres_parser.ypp   | 13 ++++++-------
 lib/framework/strresly.h          |  4 ++--
 lib/gamelib/audp_parser.ypp       |  2 +-
 lib/script/chat_parser.ypp        |  2 +-
 lib/script/script_parser.ypp      |  2 +-
 src/scriptvals_parser.ypp         |  2 +-
 8 files changed, 14 insertions(+), 15 deletions(-)

Index: warzone2100-3.1.5/lib/framework/resource_parser.ypp
===================================================================
--- warzone2100-3.1.5.orig/lib/framework/resource_parser.ypp	2016-06-21 22:42:29.772291343 +0200
+++ warzone2100-3.1.5/lib/framework/resource_parser.ypp	2016-06-21 22:42:29.768291293 +0200
@@ -47,7 +47,7 @@
 
 %}
 
-%name-prefix="res_"
+%name-prefix "res_"
 
 %union {
 	char  *sval;
Index: warzone2100-3.1.5/lib/framework/strres_lexer.lpp
===================================================================
--- warzone2100-3.1.5.orig/lib/framework/strres_lexer.lpp	2016-06-21 22:42:29.772291343 +0200
+++ warzone2100-3.1.5/lib/framework/strres_lexer.lpp	2016-06-21 22:42:29.768291293 +0200
@@ -105,7 +105,7 @@
 	/* Match quoted text */
 \"							{ BEGIN QUOTE; }
 <QUOTE>\"					{ BEGIN 0; }
-<QUOTE>\n					{ strres_error("Unexpected end of line in string"); }
+<QUOTE>\n					{ strres_error(NULL, "Unexpected end of line in string"); }
 <QUOTE>[^\"\n]*				{
 								strres_lval.sval = strdup(yytext);
 								return QTEXT_T;
Index: warzone2100-3.1.5/lib/framework/strres_parser.ypp
===================================================================
--- warzone2100-3.1.5.orig/lib/framework/strres_parser.ypp	2016-06-21 22:42:29.772291343 +0200
+++ warzone2100-3.1.5/lib/framework/strres_parser.ypp	2016-06-21 22:42:29.768291293 +0200
@@ -32,19 +32,18 @@
 extern int strres_get_lineno(void);
 extern char* strres_get_text(void);
 
-void yyerror(const char* msg)
-{
-	debug(LOG_ERROR, "STRRES file parse error:\n%s at line %d\nText: '%s'", msg, strres_get_lineno(), strres_get_text());
-}
-
 // Forward declaration to allow pointers to this type
 struct STR_RES;
 
-#define YYPARSE_PARAM psStrRes
+void yyerror(struct STR_RES *p, const char* msg)
+{
+	debug(LOG_ERROR, "STRRES file parse error:\n%s at line %d\nText: '%s'", msg, strres_get_lineno(), strres_get_text());
+}
 
 %}
 
-%name-prefix="strres_"
+%parse-param {struct STR_RES *psStrRes}
+%name-prefix "strres_"
 
 %union {
 	char  *sval;
Index: warzone2100-3.1.5/lib/framework/strresly.h
===================================================================
--- warzone2100-3.1.5.orig/lib/framework/strresly.h	2016-06-21 22:42:29.772291343 +0200
+++ warzone2100-3.1.5/lib/framework/strresly.h	2016-06-21 22:46:00.678886664 +0200
@@ -29,12 +29,12 @@
 extern void strres_set_extra(YY_EXTRA_TYPE user_defined);
 
 /* Call the yacc parser */
-extern int strres_parse(void *psStrRes);
+extern int strres_parse(struct STR_RES *psStrRes);
 
 /* Destroy the lexer */
 extern int strres_lex_destroy(void);
 
-void strres_error(const char *msg);
+void strres_error(struct STR_RES *p, const char* msg);
 
 /* Store a string */
 extern bool strresStoreString(struct STR_RES *psRes, const char *pID, const char *pString);
Index: warzone2100-3.1.5/lib/gamelib/audp_parser.ypp
===================================================================
--- warzone2100-3.1.5.orig/lib/gamelib/audp_parser.ypp	2016-06-21 22:42:29.772291343 +0200
+++ warzone2100-3.1.5/lib/gamelib/audp_parser.ypp	2016-06-21 22:42:29.768291293 +0200
@@ -39,7 +39,7 @@
 
 %}
 
-%name-prefix="audp_"
+%name-prefix "audp_"
 
 %union {
 	float		fval;
Index: warzone2100-3.1.5/lib/script/chat_parser.ypp
===================================================================
--- warzone2100-3.1.5.orig/lib/script/chat_parser.ypp	2016-06-21 22:42:29.772291343 +0200
+++ warzone2100-3.1.5/lib/script/chat_parser.ypp	2016-06-21 22:42:29.768291293 +0200
@@ -173,7 +173,7 @@
 
 %}
 
-%name-prefix="chat_"
+%name-prefix "chat_"
 
 %union {
 	int32_t				bval;
Index: warzone2100-3.1.5/lib/script/script_parser.ypp
===================================================================
--- warzone2100-3.1.5.orig/lib/script/script_parser.ypp	2016-06-21 22:42:29.772291343 +0200
+++ warzone2100-3.1.5/lib/script/script_parser.ypp	2016-06-21 22:42:29.772291343 +0200
@@ -1554,7 +1554,7 @@
 
 %}
 
-%name-prefix="scr_"
+%name-prefix "scr_"
 
 %union {
 	/* Types returned by the lexer */
Index: warzone2100-3.1.5/src/scriptvals_parser.ypp
===================================================================
--- warzone2100-3.1.5.orig/src/scriptvals_parser.ypp	2016-06-21 22:42:29.772291343 +0200
+++ warzone2100-3.1.5/src/scriptvals_parser.ypp	2016-06-21 22:42:29.772291343 +0200
@@ -113,7 +113,7 @@
 
 %}
 
-%name-prefix="scrv_"
+%name-prefix "scrv_"
 %defines
 %error-verbose
 
